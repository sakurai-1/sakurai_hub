<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sakurai's Hub</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Raleway:wght@300;400;600;700&family=Exo+2:wght@300;400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
  --primary: #00ffff;
  --secondary: #9d00ff;
  --accent: #00ffaa;
  --dark-bg: #0a0a1a;
  --darker-bg: #050510;
  --card-bg: rgba(10, 15, 30, 0.7);
  --text-light: #ffffff;
  --text-gray: #b0b0d0;
  --glow-primary: 0 0 30px var(--primary);
  --gradient-main: linear-gradient(135deg, var(--primary), var(--secondary));
}

/* БЛОКИРОВКА ВЫДЕЛЕНИЯ ТЕКСТА */
body, .card, .nav-btn, .section-title, .stat-card, .review, 
.welcome-message, .detailed-stats, .modal-content, 
.rating-value, .stat-value, .card-title, .card-description,
.stat-label, .welcome-text, .review-text, .stat-label-detailed,
.stat-value-detailed, .modal-title, .form-label, .logo {
  -webkit-user-select: none; /* Safari */
  -moz-user-select: none;    /* Firefox */
  -ms-user-select: none;     /* IE10+/Edge */
  user-select: none;         /* Стандартный синтаксис */
}

/* Исключения для полей ввода */
.form-input, .form-textarea {
  -webkit-user-select: text !important;
  -moz-user-select: text !important;
  -ms-user-select: text !important;
  user-select: text !important;
}

* { 
  margin:0; 
  padding:0; 
  box-sizing:border-box; 
  cursor: default !important;
}

html, body { 
  height:100%; 
  font-family:'Exo 2', 'Raleway', sans-serif; 
  overflow-x:hidden; 
  background: var(--dark-bg);
  color:var(--text-light);
  background-image: 
    radial-gradient(circle at 20% 30%, rgba(157, 0, 255, 0.15) 0%, transparent 50%),
    radial-gradient(circle at 80% 70%, rgba(0, 255, 255, 0.1) 0%, transparent 50%);
}

::-webkit-scrollbar { 
  width: 10px; 
}

::-webkit-scrollbar-track { 
  background: rgba(0, 255, 255, 0.05); 
  border-radius: 10px; 
}

::-webkit-scrollbar-thumb { 
  background: var(--gradient-main); 
  border-radius: 10px; 
}

::-webkit-scrollbar-thumb:hover { 
  background: linear-gradient(135deg, var(--accent), var(--primary)); 
}

header {
  width:100%; 
  padding:15px 5%;
  background: rgba(5, 5, 20, 0.9);
  backdrop-filter: blur(20px) saturate(180%);
  display:flex; 
  justify-content:space-between; 
  align-items:center; 
  position:fixed; 
  top:0; 
  left:0; 
  z-index:1000; 
  border-bottom: 2px solid rgba(0, 255, 255, 0.1);
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
}

.logo {
  font-family:'Orbitron', sans-serif; 
  font-size:2.2em; 
  font-weight:900;
  background: var(--gradient-main);
  -webkit-background-clip: text;
  background-clip: text;
  color:transparent;
  text-shadow: var(--glow-primary);
  display:flex; 
  align-items:center; 
  gap:15px;
  letter-spacing: 1px;
}

.logo i { 
  font-size:1.8em; 
  animation: pulseGlow 3s infinite alternate; 
}

@keyframes pulseGlow {
  0% { filter: drop-shadow(0 0 5px var(--primary)); }
  100% { filter: drop-shadow(0 0 20px var(--primary)); }
}

.nav-buttons { 
  display:flex; 
  gap:10px; 
}

.nav-btn {
  border:none; 
  border-radius:50px; 
  padding:12px 25px;
  font-weight:700; 
  font-family:'Orbitron', sans-serif; 
  font-size:0.9em;
  background: rgba(0, 255, 255, 0.1);
  color:var(--primary); 
  cursor:pointer !important; 
  position:relative; 
  overflow:hidden; 
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  border: 1px solid rgba(0, 255, 255, 0.2);
  display: flex;
  align-items: center;
  gap: 8px;
}

.nav-btn::before {
  content:'';
  position:absolute;
  top:0;
  left:-100%;
  width:100%;
  height:100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
  transition:0.6s;
}

.nav-btn:hover::before { 
  left:100%; 
}

.nav-btn:hover, .nav-btn.active {
  background: rgba(0, 255, 255, 0.25);
  transform: translateY(-3px);
  box-shadow: 0 10px 25px rgba(0, 255, 255, 0.3);
  border-color: var(--primary);
  color:var(--text-light);
}

.nav-btn i { 
  font-size:1.1em; 
}

.tab-content { 
  display:none; 
  padding:120px 5% 40px; 
  max-width:1400px; 
  margin:0 auto; 
  opacity:0; 
  transform:translateY(20px); 
  transition:opacity 0.6s, transform 0.6s; 
  position:relative; 
  z-index:2;
}

.tab-content.active { 
  display:block; 
  opacity:1; 
  transform:translateY(0); 
}

.section-title {
  font-family:'Orbitron', sans-serif; 
  color:var(--text-light); 
  text-align:center; 
  margin-bottom:40px; 
  font-size:2.8em; 
  position:relative;
  padding-bottom:20px;
}

.section-title::after {
  content:'';
  position:absolute;
  bottom:0;
  left:50%;
  transform:translateX(-50%);
  width:150px;
  height:4px;
  background: var(--gradient-main);
  border-radius:2px;
}

.section-title i { 
  margin-right:15px; 
  background: var(--gradient-main);
  -webkit-background-clip: text;
  background-clip: text;
  color:transparent;
}

.cards-grid {
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap:30px;
  margin-top:30px;
}

.card {
  background: var(--card-bg);
  border-radius:20px;
  padding:25px;
  position:relative;
  overflow:hidden;
  transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  border: 1px solid rgba(0, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
}

.card::before {
  content:'';
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:5px;
  background: var(--gradient-main);
}

.card:hover {
  transform: translateY(-10px) scale(1.02);
  border-color: var(--primary);
  box-shadow: 0 25px 50px rgba(0, 255, 255, 0.15);
}

.card-header {
  display:flex;
  align-items:center;
  gap:15px;
  margin-bottom:15px;
}

.card-icon {
  font-size:2em;
  background: var(--gradient-main);
  -webkit-background-clip: text;
  background-clip: text;
  color:transparent;
}

.card-title {
  font-family:'Orbitron', sans-serif;
  font-size:1.5em;
  color:var(--text-light);
  font-weight:700;
}

.card-description {
  color:var(--text-gray);
  line-height:1.6;
  margin-bottom:20px;
  font-size:0.95em;
}

.rating-container {
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin:15px 0;
  padding:10px 0;
  border-top: 1px solid rgba(255,255,255,0.1);
  border-bottom: 1px solid rgba(255,255,255,0.1);
}

.stars {
  display:flex;
  gap:5px;
}

.star {
  color:#444;
  font-size:1.5em;
  cursor:pointer !important;
  transition: all 0.3s;
  text-shadow: 0 0 10px currentColor;
}

.star:hover {
  transform: scale(1.3);
  color: #ffd700;
}

.star.active { 
  color: #ffd700; 
}

.rating-value {
  font-family:'Orbitron', sans-serif;
  font-size:1.2em;
  font-weight:700;
  color:var(--primary);
  background: rgba(0, 255, 255, 0.1);
  padding:5px 15px;
  border-radius:20px;
}

.card-actions {
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:10px;
  margin-top:20px;
}

.action-btn {
  padding:12px;
  border:none;
  border-radius:12px;
  font-weight:600;
  font-family:'Exo 2', sans-serif;
  cursor:pointer !important;
  transition: all 0.3s;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
}

.btn-primary {
  background: var(--gradient-main);
  color:var(--text-light);
}

.btn-secondary {
  background: rgba(157, 0, 255, 0.2);
  color:var(--text-light);
  border:1px solid rgba(157, 0, 255, 0.3);
}

.action-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
}

.btn-primary:hover { 
  box-shadow: 0 10px 25px rgba(0, 255, 255, 0.4); 
}

.btn-secondary:hover { 
  box-shadow: 0 10px 25px rgba(157, 0, 255, 0.4); 
}

.reviews-container {
  margin-top:25px;
  max-height:200px;
  overflow-y:auto;
  padding-right:10px;
}

.review {
  background: rgba(255, 255, 255, 0.05);
  padding:15px;
  border-radius:12px;
  margin-bottom:10px;
  border-left: 3px solid var(--primary);
  animation: slideIn 0.5s ease;
}

.review-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:8px;
}

.review-author {
  font-weight:700;
  color:var(--primary);
}

.review-rating {
  color:#ffd700;
  font-size:0.9em;
}

.review-text {
  color:var(--text-gray);
  font-size:0.9em;
  line-height:1.5;
}

.stats-container {
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap:25px;
  margin:40px 0;
}

.stat-card {
  background: rgba(10, 15, 30, 0.6);
  border-radius:15px;
  padding:25px;
  text-align:center;
  border:1px solid rgba(0, 255, 255, 0.1);
  transition: all 0.4s;
}

.stat-card:hover {
  border-color: var(--primary);
  transform: translateY(-5px);
}

.stat-icon {
  font-size:2.5em;
  margin-bottom:15px;
  color:var(--primary);
}

.stat-value {
  font-family:'Orbitron', sans-serif;
  font-size:2.8em;
  font-weight:900;
  background: var(--gradient-main);
  -webkit-background-clip: text;
  background-clip: text;
  color:transparent;
  margin:10px 0;
}

.stat-label {
  color:var(--text-gray);
  font-size:0.9em;
  text-transform:uppercase;
  letter-spacing:1px;
}

.detailed-stats {
  background: rgba(10, 15, 30, 0.6);
  border-radius:20px;
  padding:30px;
  margin-top:40px;
  border:1px solid rgba(0, 255, 255, 0.1);
}

.detailed-stats h3 {
  color:var(--primary);
  margin-bottom:25px;
  font-family:'Orbitron', sans-serif;
  font-size:1.5em;
}

.stat-row {
  display:flex;
  justify-content:space-between;
  padding:12px 0;
  border-bottom:1px solid rgba(255,255,255,0.05);
}

.stat-label-detailed {
  color:var(--text-gray);
}

.stat-value-detailed {
  font-weight:600;
  color:var(--text-light);
}

.modal {
  display:none;
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0, 0, 0, 0.85);
  backdrop-filter:blur(10px);
  justify-content:center;
  align-items:center;
  z-index:2000;
  animation: fadeIn 0.3s ease;
}

.modal-content {
  background: rgba(10, 15, 30, 0.95);
  padding:40px;
  border-radius:25px;
  width:90%;
  max-width:500px;
  border:2px solid var(--primary);
  box-shadow: 0 25px 50px rgba(0, 255, 255, 0.2);
  position:relative;
}

.modal-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:25px;
}

.modal-title {
  font-family:'Orbitron', sans-serif;
  font-size:1.8em;
  color:var(--primary);
}

.close-btn {
  background:none;
  border:none;
  color:var(--text-light);
  font-size:2em;
  cursor:pointer !important;
  transition:0.3s;
}

.close-btn:hover {
  color:var(--primary);
  transform:rotate(90deg);
}

.form-group {
  margin-bottom:20px;
}

.form-label {
  display:block;
  margin-bottom:8px;
  color:var(--text-light);
  font-weight:600;
}

.form-input, .form-textarea {
  width:100%;
  padding:15px;
  background: rgba(255, 255, 255, 0.05);
  border:1px solid rgba(0, 255, 255, 0.2);
  border-radius:12px;
  color:var(--text-light);
  font-family:'Exo 2', sans-serif;
  font-size:1em;
  transition:0.3s;
  cursor: text !important;
}

.form-input:focus, .form-textarea:focus {
  outline:none;
  border-color:var(--primary);
  box-shadow: 0 0 0 3px rgba(0, 255, 255, 0.1);
}

.form-textarea {
  min-height:120px;
  resize:vertical;
}

.modal-actions {
  display:flex;
  gap:15px;
  margin-top:30px;
}

@keyframes fadeIn {
  from { opacity:0; transform:translateY(20px); }
  to { opacity:1; transform:translateY(0); }
}

@keyframes slideIn {
  from { opacity:0; transform:translateX(-20px); }
  to { opacity:1; transform:translateX(0); }
}

@keyframes float {
  0%, 100% { transform:translateY(0); }
  50% { transform:translateY(-10px); }
}

.floating {
  animation:float 3s ease-in-out infinite;
}

@media (max-width: 768px) {
  header { padding:10px 20px; flex-direction:column; gap:15px; }
  .logo { font-size:1.8em; }
  .nav-buttons { width:100%; overflow-x:auto; padding-bottom:5px; }
  .nav-btn { padding:10px 15px; font-size:0.85em; }
  .section-title { font-size:2em; }
  .cards-grid { grid-template-columns:1fr; }
  .card-actions { grid-template-columns:1fr; }
  .stats-container { grid-template-columns:1fr; }
}

.welcome-message {
  text-align:center;
  padding:30px;
  background: rgba(10, 15, 30, 0.5);
  border-radius:20px;
  margin:30px auto;
  max-width:800px;
  border:1px solid rgba(0, 255, 255, 0.1);
}

.welcome-title {
  font-family:'Orbitron', sans-serif;
  font-size:2em;
  margin-bottom:15px;
  background: var(--gradient-main);
  -webkit-background-clip: text;
  background-clip: text;
  color:transparent;
}

.welcome-text {
  color:var(--text-gray);
  font-size:1.1em;
  line-height:1.6;
}

#particles-canvas {
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  pointer-events:none;
  z-index:1;
}
</style>
</head>
<body>

<canvas id="particles-canvas"></canvas>

<header>
  <div class="logo">
    <i class="fas fa-infinity"></i>
    <span>Sakurai Hub</span>
  </div>
  <div class="nav-buttons">
    <button class="nav-btn active" data-tab="home">
      <i class="fas fa-home"></i> Главная
    </button>
    <button class="nav-btn" data-tab="servers">
      <i class="fab fa-discord"></i> Серверы
    </button>
    <button class="nav-btn" data-tab="games">
      <i class="fas fa-gamepad"></i> Игры
    </button>
    <button class="nav-btn" data-tab="stats">
      <i class="fas fa-chart-line"></i> Статистика
    </button>
  </div>
</header>

<div id="home" class="tab-content active">
  <h2 class="section-title"><i class="fas fa-star"></i> Добро пожаловать</h2>
  
  <div class="welcome-message floating">
    <h3 class="welcome-title">Sakurai Information Hub</h3>
    <p class="welcome-text">
      Платформа для управления сообществами, игровыми серверами и полезными ресурсами. 
      Здесь вы найдёте актуальную информацию, сможете оставить отзывы и присоединиться к активным сообществам.
    </p>
    <div style="margin-top:20px; display:flex; gap:15px; justify-content:center; flex-wrap:wrap;">
      <button class="action-btn btn-primary" onclick="switchTab('servers')">
        <i class="fab fa-discord"></i> Серверы Discord
      </button>
      <button class="action-btn btn-secondary" onclick="switchTab('games')">
        <i class="fas fa-gamepad"></i> Игры Roblox
      </button>
    </div>
  </div>

  <div class="stats-container">
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-users"></i></div>
      <div class="stat-value" id="totalUsers">0</div>
      <div class="stat-label">Пользователей</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-server"></i></div>
      <div class="stat-value" id="totalServers">0</div>
      <div class="stat-label">Серверов</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-star"></i></div>
      <div class="stat-value" id="avgRating">0.0</div>
      <div class="stat-label">Средний рейтинг</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-comment"></i></div>
      <div class="stat-value" id="totalReviews">0</div>
      <div class="stat-label">Отзывов</div>
    </div>
  </div>
</div>

<div id="servers" class="tab-content">
  <h2 class="section-title"><i class="fab fa-discord"></i> Discord Серверы</h2>
  <div class="cards-grid" id="servers-container">
    <!-- Карточки добавляются динамически -->
  </div>
</div>

<div id="games" class="tab-content">
  <h2 class="section-title"><i class="fas fa-gamepad"></i> Roblox Игры</h2>
  <div class="cards-grid" id="games-container">
    <!-- Карточки добавляются динамически -->
  </div>
</div>

<div id="stats" class="tab-content">
  <h2 class="section-title"><i class="fas fa-chart-line"></i> Статистика</h2>
  
  <div class="stats-container">
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-calendar-day"></i></div>
      <div class="stat-value" id="todayVisits">0</div>
      <div class="stat-label">Сегодня</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-calendar-week"></i></div>
      <div class="stat-value" id="weekVisits">0</div>
      <div class="stat-label">За неделю</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-calendar-month"></i></div>
      <div class="stat-value" id="monthVisits">0</div>
      <div class="stat-label">За месяц</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-chart-bar"></i></div>
      <div class="stat-value" id="totalVisits">0</div>
      <div class="stat-label">Всего посещений</div>
    </div>
  </div>
  
  <div class="detailed-stats">
    <h3><i class="fas fa-info-circle"></i> Детальная статистика</h3>
    <div class="stat-row">
      <span class="stat-label-detailed">Всего уникальных пользователей:</span>
      <span class="stat-value-detailed" id="uniqueUsers">0</span>
    </div>
    <div class="stat-row">
      <span class="stat-label-detailed">Положительных отзывов:</span>
      <span class="stat-value-detailed" id="positivePercent">0%</span>
    </div>
    <div class="stat-row">
      <span class="stat-label-detailed">Средняя оценка серверов:</span>
      <span class="stat-value-detailed" id="avgServerRating">0.0</span>
    </div>
    <div class="stat-row">
      <span class="stat-label-detailed">Средняя оценка игр:</span>
      <span class="stat-value-detailed" id="avgGameRating">0.0</span>
    </div>
    <div class="stat-row">
      <span class="stat-label-detailed">Активность за 24 часа:</span>
      <span class="stat-value-detailed" id="active24h">0</span>
    </div>
    <div class="stat-row">
      <span class="stat-label-detailed">Последнее обновление:</span>
      <span class="stat-value-detailed" id="lastUpdate">-</span>
    </div>
  </div>
  
  <div style="margin-top:50px; text-align:center;">
    <button class="action-btn btn-primary" onclick="refreshStatistics()">
      <i class="fas fa-sync-alt"></i> Обновить статистику
    </button>
    <button class="action-btn btn-secondary" onclick="exportStatistics()" style="margin-left:15px;">
      <i class="fas fa-download"></i> Экспорт данных
    </button>
  </div>
</div>

<div id="reviewModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title"><i class="fas fa-edit"></i> Оставить отзыв</h3>
      <button class="close-btn" onclick="closeModal('reviewModal')">&times;</button>
    </div>
    
    <div class="form-group">
      <label class="form-label">Ваше имя:</label>
      <input type="text" class="form-input" id="reviewName" placeholder="Введите ваше имя" maxlength="30">
    </div>
    
    <div class="form-group">
      <label class="form-label">Ваш отзыв:</label>
      <textarea class="form-textarea" id="reviewText" placeholder="Поделитесь вашим мнением..." maxlength="300"></textarea>
    </div>
    
    <div class="form-group">
      <label class="form-label">Рейтинг:</label>
      <div class="stars" id="modalStars">
        <span class="star" data-value="1">★</span>
        <span class="star" data-value="2">★</span>
        <span class="star" data-value="3">★</span>
        <span class="star" data-value="4">★</span>
        <span class="star" data-value="5">★</span>
      </div>
    </div>
    
    <div class="modal-actions">
      <button class="action-btn btn-primary" onclick="submitReview()" style="flex:1;">
        <i class="fas fa-paper-plane"></i> Отправить
      </button>
      <button class="action-btn btn-secondary" onclick="closeModal('reviewModal')" style="flex:1;">
        <i class="fas fa-times"></i> Отмена
      </button>
    </div>
  </div>
</div>

<script>
// ============================================
// КОНФИГУРАЦИЯ САЙТА
// ============================================

const SITE_CONFIG = {
  servers: [
    {
      id: "server1",
      name: "Sky Mushroom Valley",
      description: "Игровое сообщество лучших грибников в роблоксе,тут вы можете узнать много нового о разных видах грибов и пообщаться с участниками,и вместе поиграть в нашу уникальную игру в Roblox.",
      link: "https://discord.gg/yETpjKeepz"
    },
    {
      id: "server2",
      name: "Soviet RolePlay",
      description: "Игровое сообщество CRMP игры в роблоксе,тут вы можете отыграть RolePlay и весело общаться с участниками дискорд сервера.",
      link: "https://discord.gg/NSDXsJxfx4"
    }
  ],
  
  games: [
    {
      id: "game1",
      name: "Sky Mushroom Valley",
      description: "Попробуйте себя в роли грибника и начните собирать разные виы грибов и изучите много нового для себя,только в Roblox и только у нас лучшие ивенты и крутые обновления каждое воскресенье!",
      link: "https://www.roblox.com/games/your-game-id-here"
    },
    {
      id: "game2",
      name: "Soviet RolePlay",
      description: "Лучшая CRMP игра за все время на платформе Roblox,единственная игра где все соблюдают RolePlay и лучшая администрация только у нас!",
      link: "https://www.roblox.com/games/your-game-id-here"
    }
  ]
};

// ============================================
// СИСТЕМА ХРАНЕНИЯ ДАННЫХ
// ============================================

const STORAGE_KEYS = {
  REVIEWS: 'sakurai_reviews',
  STATS: 'sakurai_stats',
  USERS: 'sakurai_users',
  VISITS: 'sakurai_visits'
};

let reviews = {};
let statistics = {
  totalVisits: 0,
  todayVisits: 0,
  weekVisits: 0,
  monthVisits: 0,
  uniqueUsers: new Set(),
  lastUpdate: null,
  visitHistory: {}
};

// ============================================
// СИСТЕМА БЛОКИРОВКИ ВЫДЕЛЕНИЯ ТЕКСТА
// ============================================

function disableTextSelection() {
  // Отключаем контекстное меню (правую кнопку мыши) на всем сайте
  document.addEventListener('contextmenu', function(event) {
    const isInput = event.target.matches('.form-input, .form-textarea, textarea, input, [contenteditable="true"]');
    if (!isInput) {
      event.preventDefault();
      showNotification('Контекстное меню отключено на сайте', 'info', 1500);
      return false;
    }
  }, { capture: true });
  
  // Блокируем начало выделения текста
  document.addEventListener('selectstart', function(event) {
    const isInput = event.target.matches('.form-input, .form-textarea, textarea, input, [contenteditable="true"]');
    if (!isInput) {
      event.preventDefault();
      return false;
    }
  }, { capture: true });
  
  // Блокируем перетаскивание для элементов
  document.addEventListener('dragstart', function(event) {
    if (event.target.matches('img, a, .card, .nav-btn, .logo, .section-title')) {
      event.preventDefault();
      return false;
    }
  });
  
  // Блокируем копирование через Ctrl+C или Cmd+C
  document.addEventListener('copy', function(event) {
    const isInput = event.target.matches('.form-input, .form-textarea, textarea, input, [contenteditable="true"]');
    if (!isInput) {
      event.preventDefault();
      event.clipboardData.setData('text/plain', '');
      showNotification('Копирование текста отключено на сайте', 'warning', 2000);
      return false;
    }
  }, { capture: true });
  
  // Блокируем вырезание текста через Ctrl+X или Cmd+X
  document.addEventListener('cut', function(event) {
    const isInput = event.target.matches('.form-input, .form-textarea, textarea, input, [contenteditable="true"]');
    if (!isInput) {
      event.preventDefault();
      showNotification('Вырезание текста отключено на сайте', 'warning', 2000);
      return false;
    }
  }, { capture: true });
  
  // Блокируем выделение всего текста через Ctrl+A или Cmd+A
  document.addEventListener('keydown', function(event) {
    const isInput = event.target.matches('.form-input, .form-textarea, textarea, input, [contenteditable="true"]');
    if ((event.ctrlKey || event.metaKey) && event.key === 'a' && !isInput) {
      event.preventDefault();
      showNotification('Выделение всего текста отключено на сайте', 'warning', 2000);
      return false;
    }
  }, { capture: true });
  
  // Обработчик для двойного клика
  document.addEventListener('dblclick', function(event) {
    const isInput = event.target.matches('.form-input, .form-textarea, textarea, input, [contenteditable="true"]');
    if (!isInput) {
      event.preventDefault();
      // Визуальная обратная связь при двойном клике
      const originalColor = event.target.style.backgroundColor;
      event.target.style.backgroundColor = 'rgba(255, 255, 255, 0.05)';
      setTimeout(function() {
        event.target.style.backgroundColor = originalColor;
      }, 300);
    }
  });
  
  // Обработчик для выделения при перетаскивании мыши
  let isMouseDown = false;
  
  document.addEventListener('mousedown', function(event) {
    const isInput = event.target.matches('.form-input, .form-textarea, textarea, input, [contenteditable="true"]');
    if (!isInput) {
      isMouseDown = true;
      // Снимаем существующее выделение
      window.getSelection().removeAllRanges();
    }
  });
  
  document.addEventListener('mousemove', function(event) {
    if (isMouseDown) {
      // Предотвращаем выделение при перетаскивании мыши
      window.getSelection().removeAllRanges();
    }
  });
  
  document.addEventListener('mouseup', function() {
    isMouseDown = false;
  });
  
  // Для мобильных устройств
  document.addEventListener('touchstart', function(event) {
    const isInput = event.target.matches('.form-input, .form-textarea, textarea, input, [contenteditable="true"]');
    if (!isInput) {
      // Снимаем выделение на мобильных устройствах
      window.getSelection().removeAllRanges();
    }
  }, { passive: false });
  
  // Устанавливаем атрибуты для всех элементов, кроме полей ввода
  document.querySelectorAll('*:not(.form-input):not(.form-textarea):not(textarea):not(input):not([contenteditable="true"])').forEach(function(element) {
    element.setAttribute('unselectable', 'on');
    element.style.cursor = 'default';
  });
  
  // Устанавливаем начальное состояние - без выделения
  window.getSelection().removeAllRanges();
}

// ============================================
// ИНИЦИАЛИЗАЦИЯ
// ============================================

document.addEventListener('DOMContentLoaded', function() {
  loadAllData();
  initVisitTracking();
  renderAllContent();
  initParticles();
  initEventListeners();
  updateAllStatistics();
  
  // Инициализация системы блокировки выделения текста
  disableTextSelection();
  
  document.body.style.opacity = '0';
  setTimeout(function() {
    document.body.style.transition = 'opacity 0.8s';
    document.body.style.opacity = '1';
  }, 100);
});

function loadAllData() {
  // Загрузка отзывов из локального хранилища
  const savedReviews = localStorage.getItem(STORAGE_KEYS.REVIEWS);
  reviews = savedReviews ? JSON.parse(savedReviews) : {};
  
  // Загрузка статистики из локального хранилища
  const savedStats = localStorage.getItem(STORAGE_KEYS.STATS);
  if (savedStats) {
    const parsedStats = JSON.parse(savedStats);
    statistics = {
      ...parsedStats,
      uniqueUsers: new Set(parsedStats.uniqueUsers || [])
    };
  }
}

function saveAllData() {
  localStorage.setItem(STORAGE_KEYS.REVIEWS, JSON.stringify(reviews));
  
  const statsToSave = {
    ...statistics,
    uniqueUsers: Array.from(statistics.uniqueUsers)
  };
  localStorage.setItem(STORAGE_KEYS.STATS, JSON.stringify(statsToSave));
}

// ============================================
// ТРЕКИНГ ПОСЕЩЕНИЙ
// ============================================

function initVisitTracking() {
  const now = new Date();
  const today = now.toDateString();
  const weekKey = getWeekKey(now);
  const monthKey = getMonthKey(now);
  
  // Обновление счетчиков
  statistics.totalVisits++;
  statistics.todayVisits++;
  
  // Обновление уникальных пользователей
  const userKey = getCookie('user_id') || generateUserId();
  setCookie('user_id', userKey, 365);
  statistics.uniqueUsers.add(userKey);
  
  // Обновление недельной и месячной статистики
  if (!statistics.visitHistory[today]) {
    statistics.visitHistory[today] = 0;
  }
  statistics.visitHistory[today]++;
  
  // Расчет статистики за неделю и месяц
  statistics.weekVisits = calculateWeekVisits();
  statistics.monthVisits = calculateMonthVisits();
  
  statistics.lastUpdate = now.toISOString();
  
  // Сохранение данных
  saveAllData();
}

function getWeekKey(date) {
  const firstDayOfYear = new Date(date.getFullYear(), 0, 1);
  const pastDaysOfYear = (date - firstDayOfYear) / 86400000;
  return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);
}

function getMonthKey(date) {
  return date.getFullYear() + '-' + (date.getMonth() + 1);
}

function calculateWeekVisits() {
  const now = new Date();
  const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
  let count = 0;
  
  for (let date = new Date(weekAgo); date <= now; date.setDate(date.getDate() + 1)) {
    const dayKey = date.toDateString();
    count += statistics.visitHistory[dayKey] || 0;
  }
  
  return count;
}

function calculateMonthVisits() {
  const now = new Date();
  const monthAgo = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());
  let count = 0;
  
  for (let date = new Date(monthAgo); date <= now; date.setDate(date.getDate() + 1)) {
    const dayKey = date.toDateString();
    count += statistics.visitHistory[dayKey] || 0;
  }
  
  return count;
}

function getCookie(name) {
  const value = `; ${document.cookie}`;
  const parts = value.split(`; ${name}=`);
  if (parts.length === 2) return parts.pop().split(';').shift();
}

function setCookie(name, value, days) {
  const expires = new Date(Date.now() + days * 864e5).toUTCString();
  document.cookie = `${name}=${value}; expires=${expires}; path=/`;
}

function generateUserId() {
  return 'user_' + Math.random().toString(36).substr(2, 9);
}

// ============================================
// РЕНДЕРИНГ КОНТЕНТА
// ============================================

function renderAllContent() {
  renderServers();
  renderGames();
}

function renderServers() {
  const container = document.getElementById('servers-container');
  if (!container) return;
  
  container.innerHTML = SITE_CONFIG.servers.map(function(server) {
    return `
    <div class="card" data-id="${server.id}">
      <div class="card-header">
        <div class="card-icon"><i class="fab fa-discord"></i></div>
        <h3 class="card-title">${server.name}</h3>
      </div>
      <p class="card-description">${server.description}</p>
      
      <div class="rating-container">
        <div class="stars" id="stars-${server.id}">
          <span class="star" data-value="1">★</span>
          <span class="star" data-value="2">★</span>
          <span class="star" data-value="3">★</span>
          <span class="star" data-value="4">★</span>
          <span class="star" data-value="5">★</span>
        </div>
        <div class="rating-value" id="rating-${server.id}">${getAverageRating(server.id)}/5</div>
      </div>
      
      <div class="card-actions">
        <button class="action-btn btn-primary" onclick="openLink('${server.link}')">
          <i class="fas fa-external-link-alt"></i> Присоединиться
        </button>
        <button class="action-btn btn-secondary" onclick="openReviewModal('${server.id}')">
          <i class="fas fa-edit"></i> Отзыв
        </button>
      </div>
      
      <div class="reviews-container" id="reviews-${server.id}">
        ${renderReviews(server.id)}
      </div>
    </div>
    `;
  }).join('');
}

function renderGames() {
  const container = document.getElementById('games-container');
  if (!container) return;
  
  container.innerHTML = SITE_CONFIG.games.map(function(game) {
    return `
    <div class="card" data-id="${game.id}">
      <div class="card-header">
        <div class="card-icon"><i class="fas fa-gamepad"></i></div>
        <h3 class="card-title">${game.name}</h3>
      </div>
      <p class="card-description">${game.description}</p>
      
      <div class="rating-container">
        <div class="stars" id="stars-${game.id}">
          <span class="star" data-value="1">★</span>
          <span class="star" data-value="2">★</span>
          <span class="star" data-value="3">★</span>
          <span class="star" data-value="4">★</span>
          <span class="star" data-value="5">★</span>
        </div>
        <div class="rating-value" id="rating-${game.id}">${getAverageRating(game.id)}/5</div>
      </div>
      
      <div class="card-actions">
        <button class="action-btn btn-primary" onclick="openLink('${game.link}')">
          <i class="fas fa-play"></i> Играть
        </button>
        <button class="action-btn btn-secondary" onclick="openReviewModal('${game.id}')">
          <i class="fas fa-edit"></i> Отзыв
        </button>
      </div>
      
      <div class="reviews-container" id="reviews-${game.id}">
        ${renderReviews(game.id)}
      </div>
    </div>
    `;
  }).join('');
}

function renderReviews(itemId) {
  if (!reviews[itemId] || reviews[itemId].length === 0) {
    return '<p style="color:var(--text-gray); text-align:center; padding:20px;">Пока нет отзывов. Будьте первым!</p>';
  }
  
  return reviews[itemId].slice(0, 3).map(function(review) {
    return `
    <div class="review">
      <div class="review-header">
        <span class="review-author">${review.name}</span>
        <span class="review-rating">${'★'.repeat(review.rating)}${'☆'.repeat(5-review.rating)}</span>
      </div>
      <p class="review-text">${review.text}</p>
    </div>
    `;
  }).join('');
}

// ============================================
// СИСТЕМА ОТЗЫВОВ И РЕЙТИНГА
// ============================================

let currentReviewItem = null;
let currentRating = 5;

function getAverageRating(itemId) {
  if (!reviews[itemId] || reviews[itemId].length === 0) return '0.0';
  const total = reviews[itemId].reduce(function(sum, review) {
    return sum + review.rating;
  }, 0);
  return (total / reviews[itemId].length).toFixed(1);
}

function openReviewModal(itemId) {
  currentReviewItem = itemId;
  currentRating = 5;
  
  document.getElementById('reviewName').value = '';
  document.getElementById('reviewText').value = '';
  
  updateModalStars();
  openModal('reviewModal');
}

function updateModalStars() {
  document.querySelectorAll('#modalStars .star').forEach(function(star) {
    const value = parseInt(star.dataset.value);
    star.classList.toggle('active', value <= currentRating);
  });
}

function submitReview() {
  const name = document.getElementById('reviewName').value.trim();
  const text = document.getElementById('reviewText').value.trim();
  
  if (!name || !text) {
    showNotification('Пожалуйста, заполните все поля!', 'warning');
    return;
  }
  
  if (name.length < 2) {
    showNotification('Имя должно содержать минимум 2 символа', 'warning');
    return;
  }
  
  if (text.length < 10) {
    showNotification('Отзыв должен содержать минимум 10 символов', 'warning');
    return;
  }
  
  const review = {
    name: name,
    text: text,
    rating: currentRating,
    date: new Date().toISOString(),
    userIp: 'anonymous'
  };
  
  if (!reviews[currentReviewItem]) {
    reviews[currentReviewItem] = [];
  }
  
  reviews[currentReviewItem].unshift(review);
  saveAllData();
  
  updateRatingDisplay(currentReviewItem);
  updateAllStatistics();
  
  closeModal('reviewModal');
  showNotification('Отзыв успешно добавлен!', 'success');
  
  const card = document.querySelector(`[data-id="${currentReviewItem}"]`);
  if (card) {
    card.style.transform = 'scale(1.05)';
    card.style.boxShadow = '0 0 40px var(--accent)';
    setTimeout(function() {
      card.style.transform = '';
      card.style.boxShadow = '';
    }, 500);
  }
}

function updateRatingDisplay(itemId) {
  const ratingValue = document.getElementById(`rating-${itemId}`);
  const reviewsContainer = document.getElementById(`reviews-${itemId}`);
  
  if (ratingValue) {
    ratingValue.textContent = `${getAverageRating(itemId)}/5`;
  }
  
  if (reviewsContainer) {
    reviewsContainer.innerHTML = renderReviews(itemId);
  }
}

// ============================================
// СИСТЕМА СТАТИСТИКИ
// ============================================

function updateAllStatistics() {
  // Основные счетчики
  updateCounter('totalUsers', statistics.uniqueUsers.size);
  updateCounter('totalServers', SITE_CONFIG.servers.length + SITE_CONFIG.games.length);
  updateCounter('totalReviews', Object.values(reviews).reduce(function(total, arr) {
    return total + arr.length;
  }, 0));
  
  // Посещения
  updateCounter('todayVisits', statistics.todayVisits);
  updateCounter('weekVisits', statistics.weekVisits);
  updateCounter('monthVisits', statistics.monthVisits);
  updateCounter('totalVisits', statistics.totalVisits);
  
  // Детальная статистика
  document.getElementById('uniqueUsers').textContent = statistics.uniqueUsers.size;
  document.getElementById('positivePercent').textContent = calculatePositiveReviews() + '%';
  document.getElementById('avgServerRating').textContent = calculateAverageRating('servers');
  document.getElementById('avgGameRating').textContent = calculateAverageRating('games');
  document.getElementById('active24h').textContent = calculate24hActivity();
  
  // Средний рейтинг
  const allReviews = Object.values(reviews).flat();
  const avgRating = allReviews.length > 0 ? 
    (allReviews.reduce(function(sum, review) {
      return sum + review.rating;
    }, 0) / allReviews.length).toFixed(1) : '0.0';
  updateCounter('avgRating', parseFloat(avgRating), true);
  
  // Время обновления
  const lastUpdate = statistics.lastUpdate ? 
    new Date(statistics.lastUpdate).toLocaleString('ru-RU') : '-';
  document.getElementById('lastUpdate').textContent = lastUpdate;
}

function calculateAverageRating(type) {
  let relevantItems = [];
  
  if (type === 'servers') {
    SITE_CONFIG.servers.forEach(function(server) {
      if (reviews[server.id]) {
        relevantItems = relevantItems.concat(reviews[server.id]);
      }
    });
  } else if (type === 'games') {
    SITE_CONFIG.games.forEach(function(game) {
      if (reviews[game.id]) {
        relevantItems = relevantItems.concat(reviews[game.id]);
      }
    });
  }
  
  if (relevantItems.length === 0) return '0.0';
  const total = relevantItems.reduce(function(sum, review) {
    return sum + review.rating;
  }, 0);
  return (total / relevantItems.length).toFixed(1);
}

function calculatePositiveReviews() {
  const allReviews = Object.values(reviews).flat();
  if (allReviews.length === 0) return 0;
  
  const positive = allReviews.filter(function(review) {
    return review.rating >= 4;
  }).length;
  return Math.round((positive / allReviews.length) * 100);
}

function calculate24hActivity() {
  const now = new Date();
  const yesterday = new Date(now.getTime() - 24 * 60 * 60 * 1000);
  let activity = 0;
  
  // Подсчет отзывов за последние 24 часа
  Object.values(reviews).forEach(function(reviewList) {
    reviewList.forEach(function(review) {
      const reviewDate = new Date(review.date);
      if (reviewDate > yesterday) {
        activity++;
      }
    });
  });
  
  return activity;
}

function updateCounter(elementId, targetValue, isDecimal = false) {
  const element = document.getElementById(elementId);
  if (!element) return;
  
  const current = parseFloat(element.textContent) || 0;
  if (current === targetValue) return;
  
  const duration = 800;
  const steps = 40;
  const increment = (targetValue - current) / steps;
  let step = 0;
  
  const timer = setInterval(function() {
    step++;
    const value = current + (increment * step);
    
    if (step >= steps) {
      element.textContent = isDecimal ? targetValue.toFixed(1) : Math.round(targetValue);
      clearInterval(timer);
    } else {
      element.textContent = isDecimal ? value.toFixed(1) : Math.round(value);
    }
  }, duration / steps);
}

function refreshStatistics() {
  // Пересчет статистики
  statistics.weekVisits = calculateWeekVisits();
  statistics.monthVisits = calculateMonthVisits();
  saveAllData();
  
  updateAllStatistics();
  showNotification('Статистика успешно обновлена!', 'success');
}

function exportStatistics() {
  const data = {
    statistics: {
      ...statistics,
      uniqueUsers: Array.from(statistics.uniqueUsers)
    },
    reviews: reviews,
    config: SITE_CONFIG,
    exportDate: new Date().toISOString()
  };
  
  const dataStr = JSON.stringify(data, null, 2);
  const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
  
  const link = document.createElement('a');
  link.setAttribute('href', dataUri);
  link.setAttribute('download', `sakurai-stats-${new Date().toISOString().split('T')[0]}.json`);
  link.click();
  
  showNotification('Данные успешно экспортированы!', 'success');
}

// ============================================
// ЧАСТИЦЫ И АНИМАЦИИ
// ============================================

function initParticles() {
  const canvas = document.getElementById('particles-canvas');
  const ctx = canvas.getContext('2d');
  
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  
  const particles = [];
  const particleCount = Math.min(100, Math.floor(window.innerWidth / 10));
  
  for (let i = 0; i < particleCount; i++) {
    particles.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      size: Math.random() * 2 + 0.5,
      speedX: (Math.random() - 0.5) * 0.5,
      speedY: (Math.random() - 0.5) * 0.5,
      color: Math.random() > 0.5 ? 'rgba(0, 255, 255, 0.5)' : 'rgba(157, 0, 255, 0.5)'
    });
  }
  
  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    particles.forEach(function(particle) {
      particle.x += particle.speedX;
      particle.y += particle.speedY;
      
      if (particle.x > canvas.width) particle.x = 0;
      if (particle.x < 0) particle.x = canvas.width;
      if (particle.y > canvas.height) particle.y = 0;
      if (particle.y < 0) particle.y = canvas.height;
      
      ctx.beginPath();
      ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
      ctx.fillStyle = particle.color;
      ctx.fill();
    });
    
    for (let i = 0; i < particles.length; i++) {
      for (let j = i + 1; j < particles.length; j++) {
        const dx = particles[i].x - particles[j].x;
        const dy = particles[i].y - particles[j].y;
        const distance = Math.sqrt(dx * dx + dy * dy);
        
        if (distance < 100) {
          ctx.beginPath();
          ctx.strokeStyle = `rgba(255, 255, 255, ${0.1 * (1 - distance/100)})`;
          ctx.lineWidth = 0.5;
          ctx.moveTo(particles[i].x, particles[i].y);
          ctx.lineTo(particles[j].x, particles[j].y);
          ctx.stroke();
        }
      }
    }
    
    requestAnimationFrame(animate);
  }
  
  animate();
  
  window.addEventListener('resize', function() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  });
}

// ============================================
// ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ
// ============================================

function switchTab(tabName) {
  document.querySelectorAll('.nav-btn').forEach(function(button) {
    button.classList.remove('active');
  });
  document.querySelectorAll('.tab-content').forEach(function(content) {
    content.classList.remove('active');
  });
  
  const activeButton = document.querySelector(`[data-tab="${tabName}"]`);
  const activeContent = document.getElementById(tabName);
  
  if (activeButton) activeButton.classList.add('active');
  if (activeContent) activeContent.classList.add('active');
}

function openLink(url) {
  window.open(url, '_blank');
}

function openModal(modalId) {
  document.getElementById(modalId).style.display = 'flex';
}

function closeModal(modalId) {
  document.getElementById(modalId).style.display = 'none';
}

function showNotification(message, type = 'info', duration = 3000) {
  const notification = document.createElement('div');
  notification.textContent = message;
  notification.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px 25px;
    background: ${type === 'success' ? 'rgba(0, 255, 170, 0.9)' : 
                type === 'error' ? 'rgba(255, 71, 87, 0.9)' : 
                type === 'warning' ? 'rgba(255, 165, 2, 0.9)' : 
                'rgba(0, 150, 255, 0.9)'};
    color: white;
    border-radius: 10px;
    z-index: 9999;
    animation: fadeIn 0.3s ease;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    font-weight: 600;
    backdrop-filter: blur(10px);
    max-width: 400px;
    word-wrap: break-word;
  `;
  
  document.body.appendChild(notification);
  
  setTimeout(function() {
    notification.style.opacity = '0';
    notification.style.transition = 'opacity 0.5s';
    setTimeout(function() {
      notification.remove();
    }, 500);
  }, duration);
}

// ============================================
// ОБРАБОТЧИКИ СОБЫТИЙ
// ============================================

function initEventListeners() {
  // Навигация
  document.querySelectorAll('.nav-btn').forEach(function(button) {
    button.addEventListener('click', function() {
      switchTab(button.dataset.tab);
    });
  });
  
  // Звезды рейтинга в модальном окне
  document.querySelectorAll('#modalStars .star').forEach(function(star) {
    star.addEventListener('click', function() {
      currentRating = parseInt(star.dataset.value);
      updateModalStars();
    });
  });
  
  // Закрытие модальных окон
  document.querySelectorAll('.modal').forEach(function(modal) {
    modal.addEventListener('click', function(event) {
      if (event.target === modal) {
        modal.style.display = 'none';
      }
    });
  });
  
  // Автосохранение каждые 30 секунд
  setInterval(saveAllData, 30000);
}

// Автоматическое обновление статистики каждые 60 секунд
setInterval(updateAllStatistics, 60000);

// ============================================
// ГЛОБАЛЬНЫЙ ЭКСПОРТ
// ============================================

window.switchTab = switchTab;
window.openLink = openLink;
window.openReviewModal = openReviewModal;
window.closeModal = closeModal;
window.submitReview = submitReview;
window.refreshStatistics = refreshStatistics;
window.exportStatistics = exportStatistics;
</script>
</body>
</html>